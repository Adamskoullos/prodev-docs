import{o as n,c as s,a}from"./app.2550f8b5.js";const t='{"title":"Composables","description":"","frontmatter":{},"headers":[{"level":2,"title":"Composables","slug":"composables"},{"level":2,"title":"getUser","slug":"getuser"},{"level":2,"title":"useSignup","slug":"usesignup"},{"level":2,"title":"useLogin","slug":"uselogin"},{"level":2,"title":"useLogout","slug":"uselogout"},{"level":2,"title":"getCollection","slug":"getcollection"},{"level":2,"title":"useCollection","slug":"usecollection"},{"level":2,"title":"getDocument","slug":"getdocument"},{"level":2,"title":"useDocument","slug":"usedocument"},{"level":2,"title":"useStorage","slug":"usestorage"}],"relativePath":"build/composables.md","lastUpdated":1617963092702}',o={},e=a('<h2 id="composables"><a class="header-anchor" href="#composables" aria-hidden="true">#</a> Composables</h2><p>The project utilises the following composablse which we will dissect now:</p><ul><li>getUser</li><li>useSignup</li><li>useLogin</li><li>useLogout</li><li>getCollection</li><li>useCollection</li><li>getDocument</li><li>useDocument</li><li>useStorage</li></ul><hr><h2 id="getuser"><a class="header-anchor" href="#getuser" aria-hidden="true">#</a> getUser</h2><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/reactivity&quot;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> fAuth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../firebase/config&quot;</span>\n\n<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span>fAuth<span class="token punctuation">.</span>currentUser<span class="token punctuation">)</span>\n\nfAuth<span class="token punctuation">.</span><span class="token function">onAuthStateChanged</span><span class="token punctuation">(</span><span class="token parameter">_user</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    user<span class="token punctuation">.</span>value <span class="token operator">=</span> _user\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">getUser</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> \n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> getUser\n\n\n</code></pre></div><p>Ref and firebase auth are imported, a const <code>user</code> is created as a ref and the value of the current user is assigned to user. If there is a current user logged in the value of user is the user object, if not the value is <code>null</code>.</p><p>Then a firebase auth method is used to add a listener for any changes in user auth and re-assigns the value of <code>user</code> on every update</p><p>the <code>getUser()</code> function is exported, which has access to <code>user</code> through closure. <code>user</code> is returned when getUser is destructed.</p><p>This composable is used any time we want to check user auth for say route guarding, adding a document to a collection, giving the user access to their own collection, logging a user in etc.</p><h2 id="usesignup"><a class="header-anchor" href="#usesignup" aria-hidden="true">#</a> useSignup</h2><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/reactivity&quot;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> fAuth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../firebase/config&quot;</span>\n\n<span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> isPending <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">signup</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">email<span class="token punctuation">,</span> password<span class="token punctuation">,</span> displayName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    error<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span>\n    isPending<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span>\n    <span class="token keyword">try</span><span class="token punctuation">{</span>\n        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> fAuth<span class="token punctuation">.</span><span class="token function">createUserWithEmailAndPassword</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> password<span class="token punctuation">)</span>\n        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">)</span><span class="token punctuation">{</span>\n            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;Could not complete the signup, please try again&#39;</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n        <span class="token keyword">await</span> res<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">updateProfile</span><span class="token punctuation">(</span><span class="token punctuation">{</span> displayName <span class="token punctuation">}</span><span class="token punctuation">)</span>\n        error<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span>\n        isPending<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span>\n\n        <span class="token keyword">return</span> res\n\n    <span class="token punctuation">}</span> \n    <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>\n        error<span class="token punctuation">.</span>value <span class="token operator">=</span> err<span class="token punctuation">.</span>message\n        isPending<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">useSignup</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span> error<span class="token punctuation">,</span> signup<span class="token punctuation">,</span> isPending <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> useSignup\n</code></pre></div><p><code>useSignup</code> is exported which returns properties <code>isPending</code> and <code>error</code> and also the <code>signup()</code> function. when the <code>signup()</code> is invoked it takes in the user inputs: <code>email</code>, <code>password</code> and <code>userName</code></p><p>error is set to null and isPending to true to use the boolean to show any loading elements. <code>signup()</code> is an asynchronous function as it is communicating with firebase and we use <code>try</code>, <code>catch</code> blocks to manage the response.</p><p>The return value of a successful response is saved to a const <code>res</code>, which is ultimately returned. If firebase has successfully accepted and created a new user the user profile is updated with their displayName. Once this has been completed via the <code>await</code> keyword the <code>ispending</code> property is set back to false and <code>res</code> is returned</p><h2 id="uselogin"><a class="header-anchor" href="#uselogin" aria-hidden="true">#</a> useLogin</h2><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/reactivity&quot;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> fAuth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../firebase/config&quot;</span>\n\n<span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> isPending <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">login</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">email<span class="token punctuation">,</span> password</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    error<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span>\n    isPending<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span>\n    <span class="token keyword">try</span><span class="token punctuation">{</span>\n        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> fAuth<span class="token punctuation">.</span><span class="token function">signInWithEmailAndPassword</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> password<span class="token punctuation">)</span>\n        error<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span>\n        isPending<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span>\n        <span class="token keyword">return</span> res\n    <span class="token punctuation">}</span>\n    <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        error<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&#39;Incorrect login credentials&#39;</span>\n        isPending<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">useLogin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span> error<span class="token punctuation">,</span> login<span class="token punctuation">,</span> isPending <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> useLogin\n\n</code></pre></div><p>Same structural pattern as previous, the <code>login()</code> function takes in the user input: <code>email</code> and <code>password</code>. within the <code>try</code> block <code>await</code> is used ahead of calling firebase Auth and using the authentication method to attempt logging the user in. Once a successful response has been returned error is set to null and isPending to false, with the response <code>res</code> being returned from <code>login()</code>.</p><h2 id="uselogout"><a class="header-anchor" href="#uselogout" aria-hidden="true">#</a> useLogout</h2><div class="language-js"><pre><code>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/reactivity&quot;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> fAuth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../firebase/config&quot;</span>\n\n<span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> isPending <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">logout</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    error<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span>\n    isPending<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span>\n    <span class="token keyword">try</span><span class="token punctuation">{</span>\n        <span class="token keyword">await</span> fAuth<span class="token punctuation">.</span><span class="token function">signOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        isPending<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        error<span class="token punctuation">.</span>value <span class="token operator">=</span> err<span class="token punctuation">.</span>message\n        isPending<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>value<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">useLogout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span> error<span class="token punctuation">,</span> logout<span class="token punctuation">,</span> isPending <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> useLogout\n\n</code></pre></div><p>Same pattern again, but using the the Firebase auth method <code>signout()</code></p><h2 id="getcollection"><a class="header-anchor" href="#getcollection" aria-hidden="true">#</a> getCollection</h2><div class="language-js"><pre><code>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/reactivity&quot;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> watchEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/runtime-core&quot;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> fStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../firebase/config&quot;</span>\n\n\n\n<span class="token keyword">const</span> <span class="token function-variable function">getCollection</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">collection<span class="token punctuation">,</span> query</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> documents <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>\n    <span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">let</span> collectionRef <span class="token operator">=</span> fStore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span>collection<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string">&#39;createdAt&#39;</span><span class="token punctuation">,</span><span class="token string">&quot;desc&quot;</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">if</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">{</span>\n        collectionRef <span class="token operator">=</span> collectionRef<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token operator">...</span>query<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">const</span> unsub <span class="token operator">=</span> collectionRef<span class="token punctuation">.</span><span class="token function">onSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">snap</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n        snap<span class="token punctuation">.</span>docs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">doc</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n            doc<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createdAt <span class="token operator">&amp;&amp;</span> results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>doc<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> id<span class="token operator">:</span> doc<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n        documents<span class="token punctuation">.</span>value <span class="token operator">=</span> results\n        error<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>\n        error<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&#39;Could not fetch data&#39;</span>\n        documents<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token comment">// unsub method to prevent multiple onSnapshot events running at the same time</span>\n    <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">onInvalidate</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token function">onInvalidate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">unsub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">{</span> documents<span class="token punctuation">,</span> error <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> getCollection\n\n</code></pre></div><p>We also import <code>watchEffect</code> here, similar to <code>watch</code>, <code>watchEffect</code> is a listener for updates to reactive properties and fires its callback every time there is an update. Unlike <code>watch</code>, <code>watchEffect</code> runs initially on load as well. we will come back to this.</p><p><code>getCollection</code> takes in two arguments: <code>collection</code> and <code>query</code> with query being some kind of filter to only grab specific documents within a collection that meet a criteria. <code>documents</code> is initially null but is returned as an array of document objects from a collection.</p><p>First we make a reference to the target collection and we are also ordering the documents using the firestore method.</p><p>Then the <code>if</code> statement checks to see if there is a query to return a filtered collection and if so chains the query onto the collection reference by using the <code>where()</code> method and spreading the query in.</p><p>Below that we add create a const <code>unsub</code> which we will come back to and add the firebase <code>onSnapshot</code> listener to the collection ref which fires every time there is an update to a document.</p><p>Diving into the callback, which takes in the particular snapshot <code>snap</code>, first the results array is set to empty, then a <code>forEach</code> is used on the firebase <code>doc.docs</code> to cycle through each document in the collection.</p><p><code>data()</code> is a firestore method to acces the document data and first there is a check for a <code>createdAt</code> property from firestore to make sure the snapshot data is not the locally emitted data, then each docs data is spread into the results array. The id is added separately as this property is not in the document object data but on the document.</p><p>Then the results array is assigned as the value of <code>documents</code>, with <code>documents</code> being returned from <code>getCollection</code>.</p><p><code>onSnapshot</code> listeners do not by default unsubscribe when the view un mounts, so to prevent them from building up on top of each other we stick the const <code>unsub</code> in front of the <code>onSnapshot</code> so we can invoke it and stop the listener.</p><p>This is done just above the returned object within the <code>watchEffect</code> function, using <code>onValidate()</code>.</p><h2 id="usecollection"><a class="header-anchor" href="#usecollection" aria-hidden="true">#</a> useCollection</h2><div class="language-js"><pre><code>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@vue/reactivity&#39;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> fStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../firebase/config&#39;</span>\n\n\n<span class="token keyword">const</span> <span class="token function-variable function">useCollection</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">collection</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>\n    <span class="token keyword">const</span> isPending <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">const</span> <span class="token function-variable function">addDoc</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        error<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span>\n        isPending<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span>\n        <span class="token keyword">try</span><span class="token punctuation">{</span>\n            <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> fStore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span>collection<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span>\n            isPending<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span>\n            <span class="token keyword">return</span> res\n        <span class="token punctuation">}</span>\n        <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>\n            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>\n            isPending<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span>\n            error<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&#39;Unable to send this message&#39;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span> addDoc<span class="token punctuation">,</span> error<span class="token punctuation">,</span> isPending <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> useCollection\n\n</code></pre></div><p>Again the same composable structure. <code>useCollection</code> takes in the collection as an argument when destructed and returns the <code>addDoc()</code> function, which itself takes in an argument, the new document to be added to the collection.</p><p>Then simply using the firestore method <code>add()</code> an attempt to add the document to the db is made. Again this is asynchronous so the keyword <code>await</code> is used. The returned value is saved to a const <code>res</code>, which is returned from the <code>addDoc()</code> function.</p><h2 id="getdocument"><a class="header-anchor" href="#getdocument" aria-hidden="true">#</a> getDocument</h2><div class="language-js"><pre><code>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/reactivity&quot;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> watchEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/runtime-core&quot;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> fStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../firebase/config&quot;</span>\n\n\n\n<span class="token keyword">const</span> <span class="token function-variable function">getDocument</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">collection<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> document <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>\n    <span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">let</span> docRef <span class="token operator">=</span> fStore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span>collection<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>\n\n    <span class="token keyword">const</span> unsub <span class="token operator">=</span> docRef<span class="token punctuation">.</span><span class="token function">onSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n            document<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span>doc<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> id<span class="token operator">:</span> doc<span class="token punctuation">.</span>id<span class="token punctuation">}</span>\n            error<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span><span class="token punctuation">{</span>\n            error<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&#39;That project does not exist&#39;</span>\n        <span class="token punctuation">}</span>\n\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>\n        error<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&#39;Could not fetch data&#39;</span>\n        document<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token comment">// unsub method to prevent multiple onSnapshot events running at the same time</span>\n    <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">onInvalidate</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token function">onInvalidate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">unsub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">{</span> document<span class="token punctuation">,</span> error <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> getDocument\n\n</code></pre></div><p>The <code>getDocument</code> function takes in the collection and document id when it is invoked and destructed, and returns <code>document</code>.</p><p>First a reference to the document is made <code>docRef</code>, then a const <code>unsub</code> (we have seen this before) is defined and used as before as a way of stopping the <code>onSnapshot</code> listener. A listener is added to the document and <code>if</code> the document has data (exists) the document data is assigned as the value of <code>document</code>.</p><h2 id="usedocument"><a class="header-anchor" href="#usedocument" aria-hidden="true">#</a> useDocument</h2><div class="language-js"><pre><code>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@vue/reactivity&#39;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> fStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../firebase/config&#39;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">useDocument</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">collection<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    \n    <span class="token keyword">let</span> error <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>\n    <span class="token keyword">let</span> isPending <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">let</span> docRef <span class="token operator">=</span> fStore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span>collection<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>\n\n    <span class="token keyword">const</span> <span class="token function-variable function">deleteDoc</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        isPending <span class="token operator">=</span> <span class="token boolean">true</span>\n        error<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span>\n        \n        <span class="token keyword">try</span><span class="token punctuation">{</span>\n            <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> docRef<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n            isPending <span class="token operator">=</span> <span class="token boolean">false</span>\n            <span class="token keyword">return</span> res\n        <span class="token punctuation">}</span>\n        <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>\n            error<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&#39;Unable to delete the project&#39;</span>\n            isPending <span class="token operator">=</span> <span class="token boolean">false</span>\n            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">const</span> <span class="token function-variable function">updateDoc</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">updates</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        isPending <span class="token operator">=</span> <span class="token boolean">true</span>\n        error<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span>\n        \n        <span class="token keyword">try</span><span class="token punctuation">{</span>\n            <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> docRef<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>updates<span class="token punctuation">)</span>\n            isPending <span class="token operator">=</span> <span class="token boolean">false</span>\n            <span class="token keyword">return</span> res\n        <span class="token punctuation">}</span>\n        <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>\n            error<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&#39;Unable to update&#39;</span>\n            isPending <span class="token operator">=</span> <span class="token boolean">false</span>\n            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">{</span> updateDoc<span class="token punctuation">,</span> deleteDoc<span class="token punctuation">,</span> error<span class="token punctuation">,</span> isPending <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> useDocument\n\n</code></pre></div><p><code>useDocument</code> takes in the collection and doc id when destructed and returns the <code>deleteDoc</code> and <code>updateDoc</code> functions.</p><p>the document reference <code>docRef</code> is used in both functions which they have access to via closure.</p><p>The <code>deleteDoc()</code> function takes no argument and simply uses the <code>delete()</code> method.</p><p>The <code>updateDoc()</code> function takes in an object including any properties and values to be updated. This function is used to update the project document when the tasks array is updated.</p><h2 id="usestorage"><a class="header-anchor" href="#usestorage" aria-hidden="true">#</a> useStorage</h2><div class="language-js"><pre><code>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/reactivity&quot;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> fStorage <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../firebase/config&quot;</span>\n<span class="token keyword">import</span> getUser <span class="token keyword">from</span> <span class="token string">&#39;@/composables/getUser&#39;</span>\n\n<span class="token keyword">const</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">useStorage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>\n    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>\n    <span class="token keyword">const</span> filePath <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">const</span> <span class="token function-variable function">uploadImage</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        filePath<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">projectImages/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>value<span class="token punctuation">.</span>uid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>\n        <span class="token keyword">const</span> storageRef <span class="token operator">=</span> fStorage<span class="token punctuation">.</span><span class="token function">ref</span><span class="token punctuation">(</span>filePath<span class="token punctuation">.</span>value<span class="token punctuation">)</span>\n        <span class="token keyword">try</span><span class="token punctuation">{</span>\n            <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> storageRef<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>\n            url<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span>ref<span class="token punctuation">.</span><span class="token function">getDownloadURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n        <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>\n            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>\n            error<span class="token punctuation">.</span>value <span class="token operator">=</span> err<span class="token punctuation">.</span>message\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">const</span> <span class="token function-variable function">deleteImage</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token keyword">const</span> storageRef <span class="token operator">=</span> fStorage<span class="token punctuation">.</span><span class="token function">ref</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>\n        <span class="token keyword">try</span><span class="token punctuation">{</span>\n            <span class="token keyword">await</span> storageRef<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n        <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>\n            error<span class="token punctuation">.</span>value <span class="token operator">=</span> err<span class="token punctuation">.</span>message\n            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>value<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span> \n\n    <span class="token keyword">return</span> <span class="token punctuation">{</span> error<span class="token punctuation">,</span> url<span class="token punctuation">,</span> filePath<span class="token punctuation">,</span> uploadImage<span class="token punctuation">,</span> deleteImage <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> useStorage \n\n</code></pre></div><p>This composable is used to add images to and remove images from firebase storage. We import <code>getUser</code> so we can add images to the users image folder as well as delete the image from their image folder.</p><p>To upload an image we first need to define a filepath and save it to a ref <code>filePath</code>. We then use the filePath to create a const <code>storageRef</code>. Then within the <code>try</code> block use <code>storageRef</code> to upload the image using the firebase storage method <code>put()</code></p><p>We save the response <code>res</code> and then use it to get the public url to access the image and display it within the application, saving this to <code>url</code></p><p>Both the <code>filePath</code> and <code>url</code> are also returned so can be used within the app.</p><p><code>deleteImage</code> takes in the <code>path</code> as an argument when it is invoked.</p>',54);o.render=function(a,t,o,p,c,u){return n(),s("div",null,[e])};export default o;export{t as __pageData};
